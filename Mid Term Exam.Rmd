---
title: "Mid Term Exam"
author: "Shadman Tousif Khandoker"
output: html_document
date: 11/10/2025
---
```{r}
# Load Libraries
library(forecast)
library(ggplot2)
library(readr)
library(tseries)
library(lubridate)
```

```{r}
# 1. Import Data
TOTALSA <- read_csv("G:/R files/Midterm/TOTALSA.csv")

# Convert Date Format
TOTALSA$Date <- mdy(TOTALSA$Date)

# Create Time Series Object
Sales_ts <- ts(TOTALSA$`Sales Units(in Millions)`, frequency = 12, start = c(2019,1))

# Cut off data starting from 2022
Sales_ts_2021 <- window(Sales_ts, start = c(2022,1))

# Use the data for analysis
Sales_ts <- Sales_ts_2021
```

```{r}
# 2. Plot and Inference
plot(Sales_ts, main = "US Car Sales (2022-2024)", 
ylab = "Sales (Millions of Units)", xlab = "Year")
```

```{r}
# 3. Central Tendency
sales_data <- TOTALSA$`Sales Units(in Millions)`
cat("Summary Statistics:\n")
summary_stats <- summary(sales_data)
print(summary_stats)

cat("\nDetailed Statistics:\n")
cat("Min:", min(sales_data), "\n")
cat("1st Quartile:", quantile(sales_data, 0.25), "\n")
cat("Median:", median(sales_data), "\n")
cat("Mean:", mean(sales_data), "\n")
cat("3rd Quartile:", quantile(sales_data, 0.75), "\n")
cat("Max:", max(sales_data), "\n")

boxplot(sales_data, main = "Box Plot of Car Sales", ylab = "Sales (Millions of Units)")
```

```{r}
# 4. Decomposition
# Test both additive and multiplicative
decomp_add <- decompose(Sales_ts, type = "additive")
decomp_mult <- decompose(Sales_ts, type = "multiplicative")

# Determine better seasonal variation
seasonal_var_add <- var(decomp_add$seasonal, na.rm = TRUE)
seasonal_var_mult <- var(decomp_mult$seasonal, na.rm = TRUE)

cat("Seasonal variance - Additive:", seasonal_var_add, "\n")
cat("Seasonal variance - Multiplicative:", seasonal_var_mult, "\n")

if(seasonal_var_add < seasonal_var_mult) {
  decomp <- decomp_add
  decomp_type <- "additive"
} else {
  decomp <- decomp_mult
  decomp_type <- "multiplicative"
}

cat("Selected decomposition type:", decomp_type, "\n")

# Decomposition plot
plot(decomp)

# Seasonal indices
seasonal_indices <- decomp$seasonal[1:12]
cat("\nSeasonal Monthly Indices:\n")
print(seasonal_indices)

# Highest and Lowest Months
months <- month.name
highest_month <- months[which.max(seasonal_indices)]
lowest_month <- months[which.min(seasonal_indices)]
cat("\nHighest sales month:", highest_month, "(Index:", round(max(seasonal_indices), 3), ")\n")
cat("Lowest sales month:", lowest_month, "(Index:", round(min(seasonal_indices), 3), ")\n")

# Reason for Seasonal Pattern
cat("\nReasons for seasonal pattern:\n")
cat("High in", highest_month, ": During Spring it is buying season, tax refunds, better weather\n")
cat("Low in", lowest_month, ": Model year changeover, end of summer sales, reaching post holiday slump\n")

# Seasonally Adjusted Data
if(decomp_type == "additive") {
  adjusted_ts <- Sales_ts - decomp$seasonal
} else {
  adjusted_ts <- Sales_ts / decomp$seasonal
}

plot(Sales_ts, col = "blue", main = "Actual vs Seasonally Adjusted Sales", 
     ylab = "Sales (Millions)", xlab = "Year")
lines(adjusted_ts, col = "red")
legend("topright", legend = c("Actual", "Seasonally Adjusted"), 
       col = c("blue", "red"), lty = 1)

cat("\nSeasonal Impact: Seasonal fluctuations account for approximately Â±", 
    round(max(abs(seasonal_indices)), 2), "million units\n")
```

```{r}
# 5. Naive Method
naive_model <- naive(Sales_ts, h = 12)

cat("\n NAIVE METHOD \n")

# Residual Analysis
cat("Residual Analysis:\n")
checkresiduals(naive_model)

# Accuracy Measures
cat("\nAccuracy Measures:\n")
naive_accuracy <- accuracy(naive_model)
print(naive_accuracy)

# Forecast
cat("\nForecast for next 12 months:\n")
naive_forecast <- naive_model$mean
print(naive_forecast)

plot(naive_model, main = "Naive Method Forecast for Car Sales")

# Naive Method Summary
cat("\nNaive Method Summary:\n")
cat("Accuracy: Poor (RMSE:", round(naive_accuracy[2], 3), "million units)\n")
cat("Next Year Prediction: Constant at", round(tail(naive_forecast, 1), 3), "million units\n")
cat("Observation: Not suitable for seasonal data with trend changes\n")
```

```{r}
# 6. Simple Moving Averages
par(mfrow = c(1,1))
plot(Sales_ts, main = "Moving Averages Comparison", ylab = "Sales (Millions)")
ma3 <- ma(Sales_ts, 3)
ma6 <- ma(Sales_ts, 6)
ma9 <- ma(Sales_ts, 9)

lines(ma3, col = "red", lwd = 2)
lines(ma6, col = "blue", lwd = 2)
lines(ma9, col = "green", lwd = 2)
legend("topright", legend = c("Original", "MA(3)", "MA(6)", "MA(9)"),
       col = c("black", "red", "blue", "green"), lty = 1, cex = 0.8)

# Bonus: Forecast using MA(6) - best balance
ma6_model <- forecast(ma(Sales_ts, 6), h = 12)
plot(ma6_model, main = "MA(6) Forecast for Next 12 Months")
cat("\nMA(6) Forecast for next 12 months:\n")
print(ma6_model$mean)

cat("\nMoving Averages Observations:\n")
cat("As moving average order increases:\n")
cat("- MA(3): More responsive but noisy\n")
cat("- MA(6): Good balance of smoothness and responsiveness\n") 
cat("- MA(9): Very smooth but significant lag in detecting changes\n")
cat("- Higher orders produce smoother lines but increase lag\n")
```

```{r}
# 7. Simple Exponential Smoothing
ses_model <- ses(Sales_ts, h = 12)

cat("\n SIMPLE EXPONENTIAL SMOOTHING \n")
cat("Model Parameters:\n")
print(ses_model$model)

# Extract parameters
alpha_value <- ses_model$model$par[1]
initial_state <- ses_model$model$par[2]
sigma_value <- ses_model$model$sigma2

cat("Alpha:", round(alpha_value, 4), "- Very high, giving almost all weight to recent observations\n")
cat("Initial State:", round(initial_state, 3), "- First observation value\n")
cat("Sigma:", round(sqrt(sigma_value), 3), "- Standard deviation of residuals\n")

# Residual Analysis
cat("\nResidual Analysis:\n")
checkresiduals(ses_model)

# Accuracy measures
cat("\nAccuracy Measures:\n")
ses_accuracy <- accuracy(ses_model)
print(ses_accuracy)

# Forecast
cat("\nForecast for next 12 months:\n")
ses_forecast <- ses_model$mean
print(ses_forecast)
plot(ses_model, main = "Simple Exponential Smoothing Forecast")

cat("\nSimple Smoothing Summary:\n")
cat("Accuracy: Moderate (RMSE:", round(ses_accuracy[2], 3), "million units)\n")
cat("Next Year Prediction: Stabilizes around", round(mean(ses_forecast), 3), "million units\n")
cat("Observation: Cannot capture seasonality, only suitable for data without seasonal patterns\n")
```

```{r}
# 8. Holt-Winters Method
hw_model <- hw(Sales_ts, h = 12, seasonal = "additive")

cat("\n HOLT-WINTERS METHOD \n")
cat("Model Parameters:\n")
print(hw_model$model)

# Extract parameters 
model_par <- hw_model$model$par
alpha_hw <- model_par["alpha"]
beta_hw <- model_par["beta"]
gamma_hw <- model_par["gamma"]

# Initial states
initial_states <- hw_model$model$states[1,]
initial_level <- initial_states[1]
initial_trend <- ifelse("b" %in% colnames(initial_states), initial_states["b"], 0)
sigma_hw <- hw_model$model$sigma2

cat("Alpha:", round(alpha_hw, 4), "- Moderate level smoothing\n")
cat("Beta:", round(beta_hw, 4), "- Very small trend component\n")
cat("Gamma:", round(gamma_hw, 4), "- Moderate seasonal smoothing\n")
cat("Initial Level:", round(initial_level, 3), "- Starting level value\n")
cat("Initial Trend:", round(initial_trend, 6), "- Starting trend value\n")
cat("Sigma:", round(sqrt(sigma_hw), 3), "- Standard deviation of residuals\n")

# Residual Analysis
cat("\nResidual Analysis:\n")
checkresiduals(hw_model)

# Accuracy measures
cat("\nAccuracy Measures:\n")
hw_accuracy <- accuracy(hw_model)
print(hw_accuracy)

# Forecast
cat("\nForecast for next 12 months:\n")
hw_forecast <- hw_model$mean
print(hw_forecast)
plot(hw_model, main = "Holt-Winters Forecast for Car Sales")

cat("\nHolt-Winters Summary:\n")
cat("Accuracy: Excellent (RMSE:", round(hw_accuracy[2], 3), "million units)\n")
cat("Next Year Prediction: Seasonal pattern with values ranging from", 
    round(min(hw_forecast), 3), "to", round(max(hw_forecast), 3), "million units\n")
cat("Observation: Best method for capturing both trend and seasonality in this data\n")
```

```{r}
# 9. Accuracy Summary
accuracy_compare <- rbind(
  naive_accuracy,
  ses_accuracy,
  hw_accuracy
)
rownames(accuracy_compare) <- c("Naive", "Simple Smoothing", "Holt-Winters")

cat("\nACCURACY COMPARISON\n")
print(accuracy_compare)

# How Useful are the Methods?
cat("\n FORECASTING METHODS DEFINITION \n")
cat("1. Naive Method: Uses the last observed value as forecast. Useful as a baseline comparison.\n")
cat("2. Simple Exponential Smoothing: Weighted average of past observations. Useful for data with no trend or seasonality.\n")
cat("3. Holt-Winters: Captures level, trend, and seasonality. Useful for seasonal time series with trends.\n")

# Best and Worst for each Accuracy Measure
accuracy_measures <- c("RMSE", "MAE", "MAPE", "MASE")
for(measure in accuracy_measures) {
  if(measure %in% colnames(accuracy_compare)) {
    best <- which.min(accuracy_compare[,measure])
    worst <- which.max(accuracy_compare[,measure])
    cat("\n", measure, ":\n")
    cat("  Best:", rownames(accuracy_compare)[best], "(", round(accuracy_compare[best, measure], 3), ")\n")
    cat("  Worst:", rownames(accuracy_compare)[worst], "(", round(accuracy_compare[worst, measure], 3), ")\n")
  }
}

cat("\nPrimary Accuracy Measure: RMSE (Root Mean Square Error)\n")
cat("Reason: RMSE gives more weight to larger errors, which is important for identifying\n")
cat("models that avoid large forecasting mistakes in business applications.\n")
```

```{r}
# 10. Conclusion
cat("\n CONCLUSION \n")
cat("Time Series Analysis Summary:\n")
cat("- Pandemic impact (2020): Dramatic 47% drop to 8.94M in April 2020\n")
cat("- Recovery phase (2021-2024): Gradual recovery stabilizing ~15-16M units\n")
cat("- Seasonal pattern: Consistent March peaks and September drops\n\n")

cat("Forecast Outlook:\n")
cat("- Next year: Stable with seasonal fluctuations (15.5M-16.5M range - Holt-Winters)\n")
cat("- Next 2 years: Likely gradual improvement as market continues to normalize\n")
cat("- Key factors: Economic conditions, supply chain stability, and consumer confidence \n")

cat("\nForecasting Methods Ranking (Best to Worst):\n")
methods_ranking <- c("Holt-Winters", "Simple Exponential Smoothing", "Naive Method")
for(i in 1:length(methods_ranking)) {
  cat(i, ". ", methods_ranking[i], "\n", sep = "")
}

cat("\nOverall Assessment:\n")
cat("Car sales have shown resilience post-pandemic but settled at a 'new normal' slightly\n")
cat("below pre-pandemic levels. The market appears to have stabilized, with Holt-Winters\n")
cat("forecasting continued seasonal patterns without major trend changes in the near term.\n")
cat("Based on the analysis, sales are expected to remain relatively flat over the next year\n") 
cat("with potential gradual improvement over the next 2 years as the market fully recovers.\n")
```

